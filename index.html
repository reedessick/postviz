<html>

<header>
	<script src="postviz.js"></script>
	<script src="../healpix.js/healpix.js"></script>
	<script src="../fitsjs/lib/fits.js"></script>
	<script src="nside32.js">//defines global variables...this is not great...</script>
</header>

<body>
	<p id='skymap'>
		<svg id="svgskymap" xmlns=svgns width="1000" height="600" > </svg>
		<svg id="svgzoom" xmlns=svgns width="600" height="600"> </svg>
	</p>

	<p id='par1'>
		mouse over a pixel to learn it's pix_id
	</p>
	<p id='coord'>
		mouse over image to get coords
	</p>

	<p id='find pixels'>
		<input id="numb" type="number">
		<button id='svgbutton' onclick="color_pixel('rgb(0,0,0)', document.getElementById('numb').value)">find pixel</button>
	</p>

	<p id='reset pixels'>
		<button id='reset' onclick="fillin_pixels()">reset pixels</button>
	</p>

<script>

// read fits file
/*
var url;
//url  = "/home/reed/LIGO/viz/postviz/sample.fits.gz";
url = "/home/reed/LIGO/viz/postviz/sample.json";


// brute force
var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		cosole.log( JSON.parse(xmlhttp.responseText) ) ;
	}
}
xmlhttp.open("GET", url, true);
xmlhttp.send();

// fitsjs
//var fits = new astro.FITS(url, callback);
*/

var npix = sample.length ;
var nside = npix2nside( npix );
//var nside = Math.pow(2, 5);

// set up parameters for svg skymap
var buffer = 10;
var r = 2;

/*
var pix_params = { nside:nside, buffer:buffer, parent_id:"svgskymap", 
	zoom_id:"svgzoom", r:r, zoom_radius:15 };
*/
var pix_params = { nside:nside, buffer:buffer, parent_id:"svgskymap", 
	zoom_id:"svgzoom", r:r, zoom_radius:10, projection:"mollweide" };

// render pixels
create_pixels(pix_params);

// set up zoom map
element =  document.getElementById('svgskymap') ;
element.setAttributeNS(null, 'onmousemove', "update_zoom(event, pix_params)" );
element.setAttributeNS(null, 'onmouseout', "clearCoor()" );

// color pixels
fillin_pixels(); // uses the global variable "sample" to determine colors!

/*
need to set up auxiliary plots! 
These will depend on the data associated with each pixel...
Need to figure out how to load/parse data.
	Expect an array:
		len(array) = npix -> nside
		array[:,0] -> probablity of that pixel -> color!
		array[:,1:] -> figure names that will be loaded? Some sort of posterior samples that will be smoothed?
*/

</script>

</body>
</html>
